<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>form</title>
    <style type="text/css">
        *{margin:0;padding: 0;list-style: none;}
        body{background: #f6f6f6;}
        .warp{width: 1000px;height:500px;margin: 0 auto;font-size: 16px;background: #ffffff;padding:100px 20px;}
        form{position: relative;}
        form .type,form .userId{ margin-bottom: 30px;}
        form label{width: 300px;text-align: right;display: inline-block;line-height: 40px;}
        .type select{width: 230px;height: 30px;font-size: 14px;background: #ffffff;border: 1px solid #e4e4e4;}
        input[type="text"]{width: 230px;height: 30px;line-height: 30px;padding-left: 10px;font-size: 14px;border: 1px solid #e4e4e4;}
        table{width: 95%;margin-top: 50px; border-collapse:collapse;}
        table td{text-align: center;border: 1px solid #e4e4e4;padding:10px 0;}
        .plus{position: absolute;right: 0;top: 170px;font-size: 38px;cursor: pointer;font-weight: bold;color: #23b7e5;}
        .btn{text-align: center;margin-top: 50px;}
        .submit{width: 90px;height: 35px;line-height: 35px;background: #23b7e5;border: 0;color: #ffffff;font-size: 14px;border-radius: 2px;outline: none;cursor: pointer;}
    </style>
</head>
<body>
<div class="warp">
    <form>
        <div class="type">
            <label for="type">用户类型：</label>
            <select name="type" id="type">
                <option value="0">全部</option>
            </select>
        </div>
        <div class="userId">
            <label for="userId">用户ID：</label>
            <input type="text" id="userId">
        </div>
        <div class="plus" id="plus">+</div>
        <table class="table">
            <tr>
                <td><input type="text" placeholder="key" class="key"></td>
                <td><input type="text" placeholder="value" class="value"></td>
            </tr>
        </table>
        <!-- <div id="dataView"></div> -->
        <div class="btn"><input type="button" class="submit" value="提交"></div>
    </form>
</div>
<script type="text/javascript" src="../lib/jquery.js"></script>
<script type="text/javascript">
    $(document).ready(function(){

        var temp = [
            '<tr>',
            '<td><input type="text" placeholder="key" class="key"></td>',
            '<td><input type="text" placeholder="value" class="value"></td>',
            '</tr>'
        ];

        var addBtn = $('#plus');
        var table = $('.table');
        var submitArr = [{
            key1:'',
            key2:''
        }];
        var lastArr = [];
        var index = null,
                subIndex = null;
        var keyName = ['key1','key2'];

        addBtn.on('click',function(){
            addCb();
        });

        $(document).on('input','input',function(){
            var txt = $(".table input");
            var curIndex = txt.index(this);
            var val = $.trim($(this).val());
            index = parseInt(curIndex/2);
            subIndex = curIndex%2;
            submitArr[index][keyName[subIndex]] = val;
            // $('#dataView').html(JSON.stringify(submitArr));
        });


        function addCb(){
            submitArr.push({
                key1:'',
                key2:''
            });
            table.append(temp.slice().join(''));
            // $('#dataView').html(JSON.stringify(submitArr));

        }

        $(".submit").click(function(){
            $.each(submitArr,function(index,item){
                lastArr[index] = {};
                lastArr[index][item.key1] = item.key2;
            });
            console.log(lastArr);

            $.ajax({
                method: "POST",
                url:"",
                data:{ type: $("#type").val(),userId:$("#userId").val(),lastArr:lastArr}
            }).done(function(){
                alert("提交成功！");
            }).fail(function(){
                // console.log(error);
            })
        })


    })
</script>
</body>
</html>